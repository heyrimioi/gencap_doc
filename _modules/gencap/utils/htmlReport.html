

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gencap.utils.htmlReport &mdash; GENCAP 0.9.0-dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=6c04cfde"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GENCAP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">üõ†Ô∏è API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">gencap</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GENCAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">gencap.utils.htmlReport</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gencap.utils.htmlReport</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_username</span>

<div class="viewcode-block" id="HTMLReport">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HTMLReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A utility class for generating structured HTML reports with sections, tables, images, and plots.</span>

<span class="sd">    This class is designed for creating analysis or validation reports, embedding</span>
<span class="sd">    figures, tables, dataframes, and other interactive elements like filterable tables.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path where the HTML report will be saved.</span>
<span class="sd">    title : str</span>
<span class="sd">        Title of the HTML report.</span>
<span class="sd">    directory : str</span>
<span class="sd">        Directory to store temporary files (e.g., generated images).</span>
<span class="sd">    nicePlots : bool, optional</span>
<span class="sd">        Enable advanced graphics (Plotly for interactive plots) if True, else static Matplotlib.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    offline_mode : bool, optional</span>
<span class="sd">        Whether to embed Plotly offline resources in the report. Default is True.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        File path of the HTML report.</span>
<span class="sd">    basename : Path</span>
<span class="sd">        Base name of the report file.</span>
<span class="sd">    directory : str</span>
<span class="sd">        Directory where supporting files (e.g., figures) are stored.</span>
<span class="sd">    sections : list</span>
<span class="sd">        List of sections and subsections added to the report.</span>
<span class="sd">    figCount : int</span>
<span class="sd">        Counter for figures added to the report.</span>
<span class="sd">    section_counter : int</span>
<span class="sd">        Counter for sections in the report.</span>
<span class="sd">    subsection_counter : int</span>
<span class="sd">        Counter for subsections within a section.</span>
<span class="sd">    content : str</span>
<span class="sd">        Internal HTML string buffer for report content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span><span class="n">directory</span><span class="p">,</span><span class="n">nicePlots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">offline_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figCount</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to store section information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advancedGraphics</span><span class="o">=</span><span class="n">nicePlots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offline_mode</span><span class="o">=</span><span class="n">offline_mode</span>
        <span class="n">current_datetime</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">user_name</span><span class="o">=</span><span class="n">get_username</span><span class="p">()</span>

        <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;!DOCTYPE html&gt;</span>
<span class="s2">        &lt;html&gt;</span>
<span class="s2">        &lt;head&gt;</span>
<span class="s2">            &lt;title&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/title&gt;</span>
<span class="s2">             &lt;style&gt;</span>
<span class="s2">                table, th, td </span><span class="se">{{</span>
<span class="s2">                     border: 1px solid black;</span>
<span class="s2">                     border-collapse: collapse;</span>
<span class="s2">                </span><span class="se">}}</span>
<span class="s2">                th, td </span><span class="se">{{</span>
<span class="s2">                     padding-top: 10px;</span>
<span class="s2">                     padding-bottom: 20px;</span>
<span class="s2">                     padding-left: 30px;</span>
<span class="s2">                     padding-right: 40px;</span>
<span class="s2">                  </span><span class="se">}}</span>
<span class="s2">                img.auto </span><span class="se">{{</span>
<span class="s2">                    height: auto;</span>
<span class="s2">                </span><span class="se">}}</span>

<span class="s2">               &lt;/style&gt;</span>
<span class="s2">        &lt;/head&gt;</span>
<span class="s2">        &lt;body bgcolor=&quot;#ffffff&quot;&gt;</span>
<span class="s2">        &lt;h1&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;&lt;p&gt; Report Created by </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">current_datetime</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">html_content</span>

<div class="viewcode-block" id="HTMLReport.saveToHTML">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.saveToHTML">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">saveToHTML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finalize and save the HTML report to disk.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        * Automatically adds a table of contents if sections exist.</span>
<span class="sd">        * Writes the report&#39;s accumulated HTML content to `self.filename`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addSummaryTable</span><span class="p">()</span>
        <span class="c1"># Combine all HTML content and write it to the file</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">         </span><span class="se">\n</span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">        &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">+</span> <span class="n">html_content</span>
        
        <span class="c1"># Close HTML tags and save</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HTML file </span><span class="si">%s</span><span class="s2"> created successfully.,self.filename&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error when saving File </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addContent">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addContent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">html_content</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append arbitrary HTML content to the report.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        html_content : str</span>
<span class="sd">            Raw HTML string to be added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">+</span><span class="n">html_content</span></div>


<div class="viewcode-block" id="HTMLReport.addSection">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addSection">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sectionName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new top-level section to the report.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sectionName : str</span>
<span class="sd">            Title of the section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Method to add a new section to the report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">section_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;section-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">section_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Store section information</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;h2 id=&quot;</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s2">&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addSubSection">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addSubSection">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addSubSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">add_table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a subsection under the current section.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sectionName : str</span>
<span class="sd">            Title of the subsection.</span>
<span class="sd">        add_table : bool, optional</span>
<span class="sd">            Whether to include this subsection in the table of contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Method to add a new subsection to the report</span>
        <span class="k">if</span> <span class="n">add_table</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">subsection_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;section-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">subsection_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># Store subsection information</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="se">\n</span>
<span class="s2">            &lt;h3 id=&quot;</span><span class="si">{</span><span class="n">subsection_id</span><span class="si">}</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="se">\n</span>
<span class="s2">            &lt;h3&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="HTMLReport.addSummaryTable">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addSummaryTable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addSummaryTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and insert a table of contents based on added sections and subsections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Method to generate a table of contents based on added sections</span>
        <span class="n">summary_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;h2&gt;Table of contents: &lt;/h2&gt;</span>
<span class="s2">        &lt;table border=&quot;1&quot;&gt;</span>
<span class="s2">            &lt;tr&gt;&lt;th&gt;Section&lt;/th&gt;&lt;/tr&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">section_id</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;padding-left:20px;&quot;</span> <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">summary_table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;tr&gt;&lt;td style=&quot;</span><span class="si">{</span><span class="n">padding</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;a href=&quot;#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s1">&quot; &gt;</span><span class="si">{</span><span class="n">sectionName</span><span class="si">}</span><span class="s1"> &lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span>
        <span class="n">summary_table</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&lt;p&gt;&lt;/p&gt;&quot;</span>
        
        <span class="c1"># Method to add the generated summary table to the report</span>
        <span class="n">h1_end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/h1&gt;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;/h1&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="n">h1_end_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">summary_table</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">h1_end_index</span><span class="p">:]</span></div>


<div class="viewcode-block" id="HTMLReport.addImage">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addImage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">figFilenameList</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Embed one or more images into the report.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figFilenameList : str or list[str]</span>
<span class="sd">            Path(s) to image file(s) to embed.</span>
<span class="sd">        width : int, optional</span>
<span class="sd">            Container width in pixels. Automatically determined if None.</span>
<span class="sd">        caption : str, optional</span>
<span class="sd">            Caption displayed below the images.</span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            Whether to delete the source image files after embedding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figFilenameList</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">figFilenameList</span><span class="o">=</span><span class="p">[</span><span class="n">figFilenameList</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figFilenameList</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">900</span><span class="o">//</span><span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">figFilenameList</span><span class="p">)))</span>

        <span class="n">html_content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;p&gt;&lt;div style=&quot;width: </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">px; height: auto;&quot; &gt; &quot;&quot;&quot;</span>
        <span class="n">percent</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">figFilenameList</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">imageFilename</span> <span class="ow">in</span> <span class="n">figFilenameList</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">imageFilename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># read bytes from file</span>
            <span class="n">data_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># encode to base64 (bytes)</span>
            <span class="n">html_content</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;img class=&quot;auto&quot; width=&quot;</span><span class="si">{</span><span class="n">percent</span><span class="si">}</span><span class="s2">%&quot; src=&quot;data:image/jpeg;base64,</span><span class="si">{</span><span class="n">data_base64</span><span class="si">}</span><span class="s2">&quot;&gt;&quot;&quot;&quot;</span>
             <span class="c1">#remove figure file</span>
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">imageFilename</span><span class="p">)</span>
        <span class="n">html_content</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">         </span><span class="si">{</span><span class="n">caption</span><span class="si">}</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addDataFrame">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addDataFrame">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a pandas DataFrame as an HTML table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            DataFrame to display.</span>
<span class="sd">        title : str</span>
<span class="sd">            Title displayed above the table.</span>
<span class="sd">        hide : bool, optional</span>
<span class="sd">            If True, hide the table by default and provide a toggle button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hide</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">df_html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;p&gt;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">df_html</span><span class="si">}</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hide</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">table_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;table_</span><span class="si">{</span><span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Unique ID for the table</span>

            <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">            &lt;button onclick=&quot;toggleTable(&#39;</span><span class="si">{</span><span class="n">table_id</span><span class="si">}</span><span class="s2">&#39;)&quot;&gt;Show/Hide Table&lt;/button&gt;</span><span class="se">\n</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div id=&quot;</span><span class="si">{</span><span class="n">table_id</span><span class="si">}</span><span class="s2">&quot; style=&quot;display: none;&quot;&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="n">html_content</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/div&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;script&gt;</span>
<span class="s2">                function toggleTable(id) {</span>
<span class="s2">                    var tableDiv = document.getElementById(id);</span>
<span class="s2">                    if (tableDiv.style.display === &quot;none&quot;) {</span>
<span class="s2">                        tableDiv.style.display = &quot;block&quot;;</span>
<span class="s2">                    } else {</span>
<span class="s2">                        tableDiv.style.display = &quot;none&quot;;</span>
<span class="s2">                    }</span>
<span class="s2">                }</span>
<span class="s2">            &lt;/script&gt;</span>
<span class="s2">            </span><span class="se">\n</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addFigure">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addFigure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addFigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span><span class="n">fig_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a single figure to the report.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig : matplotlib.figure.Figure or plotly.graph_objs.Figure</span>
<span class="sd">            The figure to be added.</span>
<span class="sd">        title : str</span>
<span class="sd">            Title displayed above the figure.</span>
<span class="sd">        fig_type : {&#39;plt&#39;, &#39;plotly&#39;}, optional</span>
<span class="sd">            Explicitly specify the figure type. Overrides autodetection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig_type</span> <span class="o">==</span><span class="s2">&quot;plt&quot;</span><span class="p">:</span>
            <span class="n">advancedGraphics</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">fig_type</span> <span class="o">==</span><span class="s2">&quot;plotly&quot;</span><span class="p">:</span>
            <span class="n">advancedGraphics</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">fig_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">advancedGraphics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">advancedGraphics</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not supported fig_type was assigned. GENCAP only supports matplotlib.figure.Figure (fig_type=&#39;plt&#39;) and plotly.graph_objects.Figure (fig_type=&#39;plotly&#39;)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">advancedGraphics</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1">#save current backend</span>
            <span class="n">backEnd</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
            <span class="c1">#use agg backend to generate image to file</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>

            <span class="n">figSuffix</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figCount</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span>
            <span class="n">figFilename</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">figSuffix</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figFilename</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="c1">#restore the matplolib backend</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">backEnd</span><span class="p">)</span>
            <span class="c1">#increment the figure counter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figCount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figCount</span><span class="o">+</span><span class="mi">1</span>
            <span class="c1">#add html code</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">figFilename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># read bytes from file</span>
            <span class="n">data_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># encode to base64 (bytes)</span>
            <span class="n">html_content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;p&gt;</span>
<span class="s2">            &lt;p&gt;&lt;figure&gt;</span>
<span class="s2">            &lt;img src=&quot;data:image/jpeg;base64,</span><span class="si">{</span><span class="n">data_base64</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<span class="s2">            &lt;/figure&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="c1">#remove figure file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">figFilename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;notebook&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline_mode</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;cdn&quot;</span>
            <span class="n">fig_html</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_plotlyjs</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">plotly_div_with_caption</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;p&gt;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">fig_html</span><span class="si">}</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">plotly_div_with_caption</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addFigurePair">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addFigurePair">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addFigurePair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">fig2</span><span class="p">,</span> <span class="n">title1</span><span class="p">,</span> <span class="n">title2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a pair of figures displayed side by side in the HTML report.</span>

<span class="sd">        This method renders two figures side by side in the report with their respective</span>
<span class="sd">        captions. It supports both Matplotlib (static images) and Plotly (interactive graphics),</span>
<span class="sd">        depending on the `self.advancedGraphics` setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig1 : matplotlib.figure.Figure or plotly.graph_objects.Figure</span>
<span class="sd">            The first figure to be displayed.</span>
<span class="sd">        fig2 : matplotlib.figure.Figure or plotly.graph_objects.Figure</span>
<span class="sd">            The second figure to be displayed.</span>
<span class="sd">        title1 : str</span>
<span class="sd">            Caption/title displayed above the first figure.</span>
<span class="sd">        title2 : str</span>
<span class="sd">            Caption/title displayed above the second figure.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        * When ``self.advancedGraphics`` is ``False``, figures are treated as Matplotlib objects</span>
<span class="sd">          and are embedded as static PNG images.</span>
<span class="sd">        * When ``self.advancedGraphics`` is ``True``, figures are assumed to be Plotly objects</span>
<span class="sd">          and are embedded with interactive capabilities.</span>
<span class="sd">        * Automatically encodes images to Base64 for inline embedding in the HTML file.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; fig1, ax1 = plt.subplots()</span>
<span class="sd">        &gt;&gt;&gt; ax1.plot([1, 2, 3], [4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; fig2, ax2 = plt.subplots()</span>
<span class="sd">        &gt;&gt;&gt; ax2.bar([1, 2, 3], [4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; report.addFigurePair(fig1, fig2, &quot;Line Plot&quot;, &quot;Bar Chart&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advancedGraphics</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="c1"># Save current backend</span>
            <span class="n">backEnd</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>

            <span class="c1"># Convert fig1 to base64</span>
            <span class="n">buf1</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
            <span class="n">buf1</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">img1_data_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf1</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

            <span class="c1"># Convert fig2 to base64</span>
            <span class="n">buf2</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
            <span class="n">buf2</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">img2_data_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf2</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

            <span class="c1"># Restore backend</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">backEnd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figCount</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># HTML for side-by-side images</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div style=&quot;display:flex; justify-content:space-around;&quot;&gt;</span>
<span class="s2">                &lt;div style=&quot;text-align:center;&quot;&gt;</span>
<span class="s2">                    &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title1</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">                    &lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">img1_data_base64</span><span class="si">}</span><span class="s2">&quot; style=&quot;max-width:90%;&quot;&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">                &lt;div style=&quot;text-align:center;&quot;&gt;</span>
<span class="s2">                    &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title2</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">                    &lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">img2_data_base64</span><span class="si">}</span><span class="s2">&quot; style=&quot;max-width:90%;&quot;&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;notebook&quot;</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline_mode</span> <span class="k">else</span> <span class="s2">&quot;cdn&quot;</span>

            <span class="n">fig1_html</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">fig1</span><span class="p">,</span> <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_plotlyjs</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">fig2_html</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_plotlyjs</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

            <span class="n">plotly_div_with_caption</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div style=&quot;display:flex; justify-content:space-around;&quot;&gt;</span>
<span class="s2">                &lt;div style=&quot;text-align:center;&quot;&gt;</span>
<span class="s2">                    &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title1</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">                    </span><span class="si">{</span><span class="n">fig1_html</span><span class="si">}</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">                &lt;div style=&quot;text-align:center;&quot;&gt;</span>
<span class="s2">                    &lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">title2</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">                    </span><span class="si">{</span><span class="n">fig2_html</span><span class="si">}</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">plotly_div_with_caption</span><span class="p">)</span></div>


<div class="viewcode-block" id="HTMLReport.addDataFrameFilter">
<a class="viewcode-back" href="../../../gencap.utils.html#gencap.utils.htmlReport.HTMLReport.addDataFrameFilter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addDataFrameFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">filter_columns</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an interactive DataFrame with column-based filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            DataFrame to display with filters.</span>
<span class="sd">        name : str</span>
<span class="sd">            Title of the table.</span>
<span class="sd">        filter_columns : list[str]</span>
<span class="sd">            Columns for which dropdown filters will be generated.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        * Allows filtering of multi-valued cells (comma-separated).</span>
<span class="sd">        * Generates inline JavaScript for client-side filtering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="c1"># Create a unique table ID</span>
        <span class="n">safe_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;table_filter_</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section_counter</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subsection_counter</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Build filter dropdown controls</span>
        <span class="n">html</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&lt;div class=&#39;filter-controls&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">filter_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_columns</span><span class="p">:</span>
            <span class="c1"># Sanitize column name for HTML ID</span>
            <span class="n">safe_col</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="k">else</span> <span class="s1">&#39;_&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">col</span><span class="p">)</span>
            <span class="n">filter_map</span><span class="p">[</span><span class="n">safe_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="c1"># Flatten list-like column values for unique dropdown entries</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            
            <span class="n">select_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">safe_col</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;label&gt;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: &lt;select id=&#39;</span><span class="si">{</span><span class="n">select_id</span><span class="si">}</span><span class="s2">&#39;&gt;&lt;option value=&#39;&#39;&gt;All&lt;/option&gt;&quot;</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">:</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;option value=&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/select&gt;&lt;/label&gt;&amp;nbsp;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Render the DataFrame and inject table ID</span>
        <span class="n">df_html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_html</span> <span class="o">=</span> <span class="n">df_html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;table&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&lt;table id=&#39;</span><span class="si">{</span><span class="n">table_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="n">df_html</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Prepare JavaScript script for filtering</span>
        <span class="n">filter_map_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">filter_map</span><span class="p">)</span>
        <span class="n">js_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="s2">        (function() {{</span>
<span class="s2">            var table = document.getElementById(&quot;</span><span class="si">{table_id}</span><span class="s2">&quot;);</span>
<span class="s2">            var filterCols = </span><span class="si">{filter_map_json}</span><span class="s2">;</span>
<span class="s2">            function applyFilter() {{</span>
<span class="s2">                var filters = {{}};</span>
<span class="s2">                for (var key in filterCols) {{</span>
<span class="s2">                    var sel = document.getElementById(&quot;</span><span class="si">{table_id}</span><span class="s2">_&quot; + key);</span>
<span class="s2">                    if (!sel) continue;</span>
<span class="s2">                    filters[key] = sel.value;</span>
<span class="s2">                }}</span>
<span class="s2">                var rows = table.tBodies[0].rows;</span>
<span class="s2">                for (var i = 0; i &lt; rows.length; i++) {{</span>
<span class="s2">                    var tr = rows[i];</span>
<span class="s2">                    var show = true;</span>
<span class="s2">                    for (var key in filters) {{</span>
<span class="s2">                        var val = filters[key];</span>
<span class="s2">                        if (val) {{</span>
<span class="s2">                            var idx = filterCols[key];</span>
<span class="s2">                            var raw = tr.cells[idx].innerText || &quot;&quot;;</span>
<span class="s2">                            // 1) remove [ ] &#39; &quot; </span>
<span class="s2">                            var clean = raw.replace(/[</span><span class="se">\\</span><span class="s2">[</span><span class="se">\\</span><span class="s2">]&#39;&quot;]/g, &quot;&quot;);</span>
<span class="s2">                            // 2) split on comma, trim whitespace</span>
<span class="s2">                            var items = clean.split(&quot;,&quot;).map(function(s) {{ return s.trim(); }});</span>
<span class="s2">                            // 3) check exact membership</span>
<span class="s2">                            if (items.indexOf(val) === -1) {{</span>
<span class="s2">                                show = false;</span>
<span class="s2">                                break;</span>
<span class="s2">                            }}</span>
<span class="s2">                        }}</span>
<span class="s2">                    }}</span>
<span class="s2">                    tr.style.display = show ? &quot;&quot; : &quot;none&quot;;</span>
<span class="s2">                }}</span>
<span class="s2">            }}</span>
<span class="s2">            // attach listeners</span>
<span class="s2">            for (var key in filterCols) {{</span>
<span class="s2">                var sel = document.getElementById(&quot;</span><span class="si">{table_id}</span><span class="s2">_&quot; + key);</span>
<span class="s2">                if (sel) sel.addEventListener(&quot;change&quot;, applyFilter);</span>
<span class="s2">            }}</span>
<span class="s2">        }})();</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># Use str.format to fill in table_id and filter_map_json</span>
        <span class="n">js</span> <span class="o">=</span> <span class="n">js_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table_id</span><span class="o">=</span><span class="n">table_id</span><span class="p">,</span>
            <span class="n">filter_map_json</span><span class="o">=</span><span class="n">filter_map_json</span>
        <span class="p">)</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="n">js</span>
        <span class="c1"># Add the interactive table to the report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">html</span><span class="p">)</span></div>
</div>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hye-Lim LEE (Epione team, Inria).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>